#!/bin/bash

# Define the target directory (Termux friendly with $PREFIX)
TARGET_DIR="${PREFIX:-/usr}/local/bin"
FILE_PATH="$TARGET_DIR/$1"

# 1. Check if an argument was provided
if [ -z "$1" ]; then
    echo "Usage: vish <filename>"
    exit 1
fi

# 2. Create the file with a shebang if it doesn't exist
if [ ! -f "$FILE_PATH" ]; then
    echo -e "#!${PREFIX:-/usr}/bin/bash\n" > "$FILE_PATH"
fi

# 3. Open the file in nano
nano +3 "$FILE_PATH"

# 4. Post-edit cleanup:
# Check if file has 1 or 0 lines AND contains (or is just) the shebang
if [ $(wc -l < "$FILE_PATH") -le 2 ] && \
perl -0777 -ne 'exit(0) if /^#!.*\n\n/m; exit(1)' "$FILE_PATH"; then
    echo "Script empty. Deleting..."
    rm "$FILE_PATH"
else
    chmod +x "$FILE_PATH"
    echo "Saved and made executable: $FILE_PATH"
fi
